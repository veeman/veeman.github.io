<!DOCTYPE html>
<html>
  <head>
    <title>Qt JSON Benutzeroberfläche Übersetzen – veeman.github.io – Persöhnlicher Blog</title>
    <!-- Begin Jekyll SEO tag v2.7.1 -->
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="Qt JSON Benutzeroberfläche Übersetzen" />
<meta name="author" content="Vitalij Mast" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="JSON steht für JavaScript Object Notation und ist ein Datenformat in lesbarer Textform, welches zum Abspeichern und einlesen von Eigenschaften bzw. Einstellungen sehr gut geeignet ist. Ich habe dieses Format erst vor kurzem kennengelernt und hab mir gedacht, dass man dieses als Sprachdatei mit dem Qt-Framework kombinieren kann. So hab ich mich mal ran gemacht und ein kleines Beispiel-Projekt erstellt. Um den Overhead der Webkit Bibliothek aus dem Weg zu gehen habe ich ein Standalone – Implementierung eines JSON Interpreters für Qt verwendet. Zu finden ist diese hier." />
<meta property="og:description" content="JSON steht für JavaScript Object Notation und ist ein Datenformat in lesbarer Textform, welches zum Abspeichern und einlesen von Eigenschaften bzw. Einstellungen sehr gut geeignet ist. Ich habe dieses Format erst vor kurzem kennengelernt und hab mir gedacht, dass man dieses als Sprachdatei mit dem Qt-Framework kombinieren kann. So hab ich mich mal ran gemacht und ein kleines Beispiel-Projekt erstellt. Um den Overhead der Webkit Bibliothek aus dem Weg zu gehen habe ich ein Standalone – Implementierung eines JSON Interpreters für Qt verwendet. Zu finden ist diese hier." />
<link rel="canonical" href="https://veeman.github.io/posts/2012/qt-json-translator/" />
<meta property="og:url" content="https://veeman.github.io/posts/2012/qt-json-translator/" />
<meta property="og:site_name" content="veeman.github.io" />
<meta property="og:image" content="https://veeman.github.io/images/2012-11-04-front-jsontranslator.gif" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2012-11-04T00:00:00+01:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://veeman.github.io/images/2012-11-04-front-jsontranslator.gif" />
<meta property="twitter:title" content="Qt JSON Benutzeroberfläche Übersetzen" />
<script type="application/ld+json">
{"@type":"BlogPosting","image":"https://veeman.github.io/images/2012-11-04-front-jsontranslator.gif","url":"https://veeman.github.io/posts/2012/qt-json-translator/","headline":"Qt JSON Benutzeroberfläche Übersetzen","dateModified":"2012-11-04T00:00:00+01:00","datePublished":"2012-11-04T00:00:00+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://veeman.github.io/posts/2012/qt-json-translator/"},"author":{"@type":"Person","name":"Vitalij Mast"},"description":"JSON steht für JavaScript Object Notation und ist ein Datenformat in lesbarer Textform, welches zum Abspeichern und einlesen von Eigenschaften bzw. Einstellungen sehr gut geeignet ist. Ich habe dieses Format erst vor kurzem kennengelernt und hab mir gedacht, dass man dieses als Sprachdatei mit dem Qt-Framework kombinieren kann. So hab ich mich mal ran gemacht und ein kleines Beispiel-Projekt erstellt. Um den Overhead der Webkit Bibliothek aus dem Weg zu gehen habe ich ein Standalone – Implementierung eines JSON Interpreters für Qt verwendet. Zu finden ist diese hier.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
<meta http-equiv='X-UA-Compatible' content='IE=edge'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>




<meta property="og:description" content="
JSON steht für JavaScript Object Notation und ist ein Datenformat in lesbarer Textform, 
welches zum Abspeichern und einlesen von Eigenschaften bzw. Einstellungen sehr gut geeignet ist. 
Ich habe dieses Format erst vor kurzem kennengelernt und hab mir gedacht, dass man dieses 
als Sprachdatei mit dem Qt-Framework kombinieren kann. So hab ich mich mal ran gemacht 
und ein kleines Beispiel-Projekt erstellt. Um den Overhead der Webkit Bibliothek aus dem Weg 
zu gehen habe ich ein Standalone – Implementierung eines JSON Interpreters für Qt verwendet. 
Zu finden ist diese hier.

" />

<meta name="author" content="veeman.github.io" />


<meta property="og:title" content="Qt JSON Benutzeroberfläche Übersetzen" />
<meta property="twitter:title" content="Qt JSON Benutzeroberfläche Übersetzen" />



<meta property="og:image" content="https://veeman.github.io/images/2012-11-04-front-jsontranslator.gif"/>
<meta property="twitter:image" content="https://veeman.github.io/images/2012-11-04-front-jsontranslator.gif"/>



    <link rel="stylesheet" type="text/css" href="/assets/style.css" />
    <link rel="alternate" type="application/rss+xml" title="veeman.github.io - Persöhnlicher Blog" href="/feed.xml" />
    <link rel="canonical" href="https://veeman.github.io/posts/2012/qt-json-translator/" />

    <meta name="theme-color" content="#000000">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
    

  </head>

  <body>
    <div class="wrapper-container">
      <div class="wrapper-masthead">
        <div class="container">
          <header class="masthead clearfix">
            <a href="/" class="site-avatar"><img src="/images/logo.png" alt="" /></a>

            <div class="site-info">
              <h1 class="site-name"><a href="/">veeman.github.io</a></h1>
              <p class="site-description">Persöhnlicher Blog</p> 
            </div>

            <nav>
              <a href="/">Blog</a>
			  <a href="/pages/categories">Kategorien</a>
              <a href="/pages/search">Suchen</a>
            </nav>
          </header>
        </div>
      </div>

      <div class="wrapper-main">
        <div id="main" role="main" class="container">
          <article class="post detailed">
  <h1>Qt JSON Benutzeroberfläche Übersetzen</h1>

  <div>
    <p class="author_title">Vitalij Mast · 4 November 2012</p>
    
    <div class="post-tags">
      
      
        <a href="/pages/categories/#c/++">c/++</a>
        &nbsp;
      
        <a href="/pages/categories/#qt">qt</a>
        &nbsp;
      
        <a href="/pages/categories/#widget">widget</a>
        &nbsp;
      
        <a href="/pages/categories/#paint">paint</a>
        &nbsp;
      
        <a href="/pages/categories/#draw">draw</a>
        
      
    </div>
  </div>
    
  <div class="entry">
    <p style="clear:both"><img src="/images/2012-11-04-front-jsontranslator.gif" alt="" style="float:right" />
JSON steht für JavaScript Object Notation und ist ein Datenformat in lesbarer Textform, 
welches zum Abspeichern und einlesen von Eigenschaften bzw. Einstellungen sehr gut geeignet ist. 
Ich habe dieses Format erst vor kurzem kennengelernt und hab mir gedacht, dass man dieses 
als Sprachdatei mit dem Qt-Framework kombinieren kann. So hab ich mich mal ran gemacht 
und ein kleines Beispiel-Projekt erstellt. Um den Overhead der Webkit Bibliothek aus dem Weg 
zu gehen habe ich ein Standalone – Implementierung eines JSON Interpreters für Qt verwendet. 
Zu finden ist diese <a href="https://github.com/ereilin/qt-json">hier</a>.</p>

<p>Das Programm selbst ist ein kleiner Rechner mit den Standardfunktionen wie Addition, Subtraktion,
Multiplikation und Division; zusätzlich mit einer Einstellbaren Sprache. Verzeiht mir an dieser Stelle,
wenn in den Sprachen irgendwelche Fehler zu finden sind, diese habe ich einfach von google Übersetzen lassen.</p>

<p>Wenn man sich das JSON Format mal näher anschaut sieht man relativ schnell wie das ganz Aufbaut ist.</p>

<figure class="highlight"><pre><code class="language-json" data-lang="json"><div class="line-1"><span class="p">{</span>
</div><div class="line-2"><span class="w">  </span><span class="nl">"QJsonTranslatorExampleForm"</span><span class="p">:</span>
</div><div class="line-3"><span class="w">  </span><span class="p">{</span>
</div><div class="line-4"><span class="w">    </span><span class="nl">"QJsonTranslatorExample"</span><span class="p">:</span><span class="w"> </span><span class="s2">"JsonTranslator Beispiel"</span><span class="p">,</span>
</div><div class="line-5"><span class="w">	</span><span class="nl">"&amp;Exit"</span><span class="p">:</span><span class="w"> </span><span class="s2">"B&amp;eenden"</span><span class="p">,</span>
</div><div class="line-6"><span class="w">	</span><span class="nl">"&amp;File"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&amp;Datei"</span><span class="p">,</span>
</div><div class="line-7"><span class="w">	</span><span class="nl">"&amp;Language"</span><span class="p">:</span><span class="w"> </span><span class="s2">"&amp;Sprache"</span><span class="p">,</span>
</div><div class="line-8"><span class="w">	</span><span class="nl">"Number One:"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Zahl Eins:"</span><span class="p">,</span>
</div><div class="line-9"><span class="w">	</span><span class="nl">"Number Two:"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Zahl Zwei:"</span><span class="p">,</span><span class="w"> </span>
</div><div class="line-10"><span class="w">	</span><span class="nl">"Add"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Addieren"</span><span class="p">,</span>
</div><div class="line-11"><span class="w">	</span><span class="nl">"Subtract"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Subtrahieren"</span><span class="p">,</span>
</div><div class="line-12"><span class="w">	</span><span class="nl">"Multiply"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Multiplizieren"</span><span class="p">,</span>
</div><div class="line-13"><span class="w">	</span><span class="nl">"Divide"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Dividieren"</span><span class="p">,</span>
</div><div class="line-14"><span class="w">  </span><span class="p">},</span>
</div><div class="line-15"><span class="w">  </span>
</div><div class="line-16"><span class="w">  </span><span class="nl">"QJsonTranslatorExample"</span><span class="p">:</span>
</div><div class="line-17"><span class="w">  </span><span class="p">{</span>
</div><div class="line-18"><span class="w">  	</span><span class="nl">"Error"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Fehler"</span><span class="p">,</span>
</div><div class="line-19"><span class="w">	</span><span class="nl">"Invalid Input"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Falsche Eingabe"</span><span class="p">,</span>
</div><div class="line-20"><span class="w">  	</span><span class="nl">"Result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Ergebnis"</span><span class="p">,</span>
</div><div class="line-21"><span class="w">	</span><span class="nl">"The result value is: %1"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Das Ergebnis lautet: %1"</span><span class="p">,</span>
</div><div class="line-22"><span class="w">  </span><span class="p">},</span>
</div><div class="line-23"><span class="p">}</span>
</div></code></pre></figure>

<p>Die Struktur besteht aus zwei Teilen, links auf der Seite steht die Eigenschaft und rechts der Wert, 
jeweils mit zwei Anführungszeichen umhüllt. Des Weiteren kann der Wert selbst auch eine Struktur sein 
womit man eine Verschachtelung erreicht. In der Sprachdatei wird nun für jede Klasse welche
irgendwelche Sprachelemente enthält so eine verschaltete Struktur erstellt.</p>

<p>Das Projekt enthält eine Klasse <code class="language-plaintext highlighter-rouge">QJsonTranslator</code> welche sich um das Laden von Sprachdateien 
und um das Übersetzen von Texten zuständig ist. Mit einem einfachen Aufruf von 
<code class="language-plaintext highlighter-rouge">QJsonTranslator::loadLanguage()</code> wird die Standardsprache geladen/verwendet. 
Der Aufruf diser sollte geschehen bevor irgendwelche Steuerelemente initialisiert werden. 
Optional kann man der Funktion einen Sprach Parameter vom Typ QLocale mitgeben. Der Pfad zu 
den Sprachdateien ist in der konstanten LANGUAGE_STD_PATH gespeichert und ist Standardmäßig auf 
‚./lang‘ gesetzt. Die Dateiendung ist in der konstanten <code class="language-plaintext highlighter-rouge">LANGUAGE_STD_SUFFIX</code> hinterlegt 
und hat den Wert, wer hätte’s gedacht, <code class="language-plaintext highlighter-rouge">.json</code>.</p>

<p>Am Anfang des Programms wird mit der Funktion <code class="language-plaintext highlighter-rouge">QJsonTranslatorExample::getAvailableLanguages()</code>
alle Verfügbaren Sprachdateien im Sprachordner gesucht und daraus ein Auswahlmenü generiert.</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><div class="line-1"><span class="kt">void</span> <span class="n">QJsonTranslatorExample</span><span class="o">::</span><span class="n">getAvailableLanguages</span><span class="p">()</span>
</div><div class="line-2"><span class="p">{</span>
</div><div class="line-3">	<span class="n">QLocale</span><span class="o">::</span><span class="n">Language</span> <span class="n">cur_lang</span> <span class="o">=</span> <span class="n">QJsonTranslator</span><span class="o">::</span><span class="n">instance</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">locale</span><span class="p">().</span><span class="n">language</span><span class="p">();</span>
</div><div class="line-4">	
</div><div class="line-5">	<span class="c1">// Auswahlgruppe erstellen</span>
</div><div class="line-6">	<span class="n">QActionGroup</span> <span class="o">*</span><span class="n">language_group</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QActionGroup</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</div><div class="line-7">	
</div><div class="line-8">	<span class="c1">// Alle json-Dateien im Sprachordner ./lang suchen</span>
</div><div class="line-9">	<span class="n">QDir</span> <span class="n">dir</span><span class="p">(</span><span class="n">LANGUAGE_STD_PATH</span><span class="p">);</span>
</div><div class="line-10">	<span class="n">QStringList</span> <span class="n">list</span> <span class="o">=</span> <span class="n">dir</span><span class="p">.</span><span class="n">entryList</span><span class="p">(</span><span class="n">QStringList</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">QString</span><span class="p">(</span><span class="s">"*%1"</span><span class="p">).</span><span class="n">arg</span><span class="p">(</span><span class="n">LANGUAGE_STD_SUFFIX</span><span class="p">));</span>
</div><div class="line-11">	<span class="n">list</span><span class="p">.</span><span class="n">prepend</span><span class="p">(</span><span class="s">"en.json"</span><span class="p">);</span>
</div><div class="line-12">	<span class="c1">// TODO: Eventuelle Duplikate entfernen.</span>
</div><div class="line-13">	
</div><div class="line-14">	<span class="c1">// Für alle Sprachdateien ein Eintrag im Menü erstellen</span>
</div><div class="line-15">	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">list</span><span class="p">.</span><span class="n">count</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
</div><div class="line-16">	<span class="p">{</span>
</div><div class="line-17">		<span class="c1">// Den Namen der Sprache extrahieren</span>
</div><div class="line-18">		<span class="n">QString</span> <span class="n">name</span> <span class="o">=</span> <span class="n">list</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">left</span><span class="p">(</span><span class="n">list</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">length</span><span class="p">()</span><span class="o">-</span><span class="n">QString</span><span class="p">(</span><span class="n">LANGUAGE_STD_SUFFIX</span><span class="p">).</span><span class="n">length</span><span class="p">());</span>
</div><div class="line-19">		<span class="n">QLocale</span> <span class="n">locale</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
</div><div class="line-20">		<span class="n">QString</span> <span class="n">nativ</span> <span class="o">=</span> <span class="n">locale</span><span class="p">.</span><span class="n">nativeLanguageName</span><span class="p">();</span>
</div><div class="line-21">		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">nativ</span><span class="p">.</span><span class="n">isEmpty</span><span class="p">())</span>
</div><div class="line-22">		<span class="p">{</span>
</div><div class="line-23">			<span class="c1">// Und falls gültig den Eintrag erstellen</span>
</div><div class="line-24">			<span class="n">QAction</span> <span class="o">*</span><span class="n">action</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QAction</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</div><div class="line-25">			<span class="n">action</span><span class="o">-&gt;</span><span class="n">setText</span><span class="p">(</span><span class="n">nativ</span><span class="p">);</span>
</div><div class="line-26">			
</div><div class="line-27">			<span class="c1">// Benutzerdaten setzen, anhand diesen wird naher bei Auswahl die Sprachdatei geladen</span>
</div><div class="line-28">			<span class="n">action</span><span class="o">-&gt;</span><span class="n">setData</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
</div><div class="line-29">			<span class="n">action</span><span class="o">-&gt;</span><span class="n">setCheckable</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
</div><div class="line-30">			<span class="n">language_group</span><span class="o">-&gt;</span><span class="n">addAction</span><span class="p">(</span><span class="n">action</span><span class="p">);</span>
</div><div class="line-31">			
</div><div class="line-32">			<span class="c1">// Wenn die Standartsprache geladen wurde, diese selektieren</span>
</div><div class="line-33">			<span class="k">if</span> <span class="p">(</span><span class="n">cur_lang</span> <span class="o">==</span> <span class="n">locale</span><span class="p">.</span><span class="n">language</span><span class="p">())</span>
</div><div class="line-34">				<span class="n">action</span><span class="o">-&gt;</span><span class="n">setChecked</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>
</div><div class="line-35">		<span class="p">}</span>
</div><div class="line-36">	<span class="p">}</span>
</div><div class="line-37">	
</div><div class="line-38">	<span class="c1">// Liste dem Sprachmenü hinzufügen</span>
</div><div class="line-39">	<span class="n">ui</span><span class="p">.</span><span class="n">menu_Language</span><span class="o">-&gt;</span><span class="n">addActions</span><span class="p">(</span><span class="n">language_group</span><span class="o">-&gt;</span><span class="n">actions</span><span class="p">());</span>
</div><div class="line-40"><span class="p">}</span>
</div></code></pre></figure>

<p>Wird nun einer dieser Spracheinträge per Menü vom Benutzer ausgewählt dann wird
die entsprechende Datei geladen:</p>

<figure class="highlight"><pre><code class="language-cpp" data-lang="cpp"><div class="line-1"><span class="k">if</span> <span class="p">(</span><span class="n">action</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">().</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="n">QVariant</span><span class="o">::</span><span class="n">String</span><span class="p">)</span>
</div><div class="line-2"><span class="p">{</span>
</div><div class="line-3">	<span class="n">QLocale</span> <span class="n">newlanguage</span><span class="p">(</span><span class="n">action</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">().</span><span class="n">toString</span><span class="p">());</span>
</div><div class="line-4">	<span class="n">QJsonTranslator</span><span class="o">::</span><span class="n">loadLanguage</span><span class="p">(</span><span class="o">&amp;</span><span class="n">newlanguage</span><span class="p">);</span>
</div><div class="line-5"><span class="p">}</span>
</div></code></pre></figure>

<p>Wenn die Sprache sich ändert wird an jedes Fenster ein <code class="language-plaintext highlighter-rouge">changeEvent</code> mit dem Parameter <code class="language-plaintext highlighter-rouge">QEvent::LanguageChange</code>
gesendet. In diesem sollte man alle Steuerelemente mit dem neuen Text laden. Dies geschieht üblicherweise
mit einem erneut zuweisen eines Textes. Zu Vereinfachung wird von QObject die Funktion
<code class="language-plaintext highlighter-rouge">QObject::tr(const char * sourceText)</code> zur Verfügung gestellt, welche den sourceText an den Übersetzer, 
in meinem Fall die Klasse <code class="language-plaintext highlighter-rouge">QJsonTranslator</code>, übergibt und den Übersetzen Text zurückgibt.</p>

<p>Es gibt sicherlich noch ein paar Fehlerfälle, die es Abzufangen gilt, jedoch denke ich, dass das Prinzip
klar sein sollte. Ansonsten schaut euch das Projekt bzw. den Source, bei Interesse, einfach hier an: 
<a href="https://github.com/veeman/QtCodeSnippets">QJsonTranslatorExample</a>.</p>


  </div>

  <div>
    <p style="float:left"><span class="share-box">Teilen:</span> <a href="http://twitter.com/share?text=Qt JSON Benutzeroberfläche Übersetzen&url=https://veeman.github.io/posts/2012/qt-json-translator/" target="_blank">Twitter</a>, <a href="https://www.facebook.com/sharer.php?u=https://veeman.github.io/posts/2012/qt-json-translator/" target="_blank">Facebook</a></p>
	<p style="float:right"><span class="share-box">Kommentieren:</span> <a href="mailto:vitali_mast@gmx.net?subject=Qt JSON Benutzeroberfläche Übersetzen"><i class="svg-glyph cmail"></i></a> </p>
	<div style="clear:both"></div>
  </div>

  <!--<div class="date">Written on November  4, 2012</div>-->

  
</article>

        </div>
      </div>

      <div class="wrapper-footer">
        <div class="container">
          <footer class="footer">
		    <div class="footer-links">
			  <a href="/pages/imprint">Impressum</a> - 
			  <a href="/pages/privacy">Datenschutzerklärung</a>
			</div>
		    <div>
				
<a href="mailto:vitali_mast@gmx.net"><i class="svg-icon email"></i></a>


<a href="https://github.com/veeman"><i class="svg-icon github"></i></a>



<a href="/feed.xml"><i class="svg-icon rss"></i></a>

<a href="http://stackoverflow.com/users/5388805/veeman"><i class="svg-icon stackoverflow"></i></a>




			</div>
          </footer>
        </div>
      </div>
    </div>

    

  </body>
</html>
